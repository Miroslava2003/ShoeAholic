<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - ShoeAholic</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/ShoeAholic.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom box-shadow">
            <div class="container-fluid">
                <div class="row w-100 align-items-center">
                    <div class="col d-flex align-items-center">
                        <button class="navbar-toggler me-2" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar" aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                        <div class="collapse navbar-collapse" id="mainNavbar">
                            @{
                                var currentCategory = Context.Request.Query["category"].ToString(); var isProducts = Context.Request.Path.Value.Contains("/Products");
                            }
                            <ul class="navbar-nav">
                                <li class="nav-item"><a class="nav-link" asp-controller="Home" asp-action="Index">НАЧАЛО</a></li>
                                <li class="nav-item"><a class="nav-link @(ViewData["ActiveCategory"]?.ToString() == "All" ? "active-nav" : "")" asp-controller="Products" asp-action="Index">ВСИЧКИ ПРОДУКТИ</a></li>
                                <li class="nav-item"><a class="nav-link @(ViewData["ActiveCategory"]?.ToString() == "Men" ? "active-nav" : "")" asp-controller="Products" asp-action="Index" asp-route-category="Men">МЪЖЕ</a></li>
                                <li class="nav-item"><a class="nav-link @(ViewData["ActiveCategory"]?.ToString() == "Women" ? "active-nav" : "")" asp-controller="Products" asp-action="Index" asp-route-category="Women">ЖЕНИ</a></li>
                                @if (User.IsInRole("Admin"))
                                {
                                    var isAdmin = Context.Request.Path.Value.Contains("/Admin");
                                    <li class="nav-item"><a class="nav-link @(isAdmin ? "active-nav" : "")" asp-controller="AdminProducts" asp-action="Dashboard">АДМИН ПАНЕЛ</a></li>
                                }
                            </ul>
                        </div>
                    </div>
                    <div class="col-auto mx-auto text-center"><a class="navbar-brand" asp-controller="Home" asp-action="Index"><img src="~/images/logo.svg" style="height:80px; width:auto;"></a></div>
                    <div class="col d-flex justify-content-end align-items-center">
                        <form asp-controller="Products" asp-action="Search" method="get" class="d-none d-lg-block">
                            <div class="input-group" style="width: 250px;">
                                <input type="text" name="q" class="form-control form-control-sm" placeholder="Търси продукти..." aria-label="Search" />
                                <button class="btn btn-outline-secondary btn-sm" type="submit"><i class="bi bi-search"></i></button>
                            </div>
                        </form>
                        <ul class="navbar-nav flex-row gap-3">
                            @if (User.Identity?.IsAuthenticated ?? false)
                            {
                                @inject ShoeAholic.Data.ShoeAholicDbContext DbContext
                                @using System.Security.Claims
                                var userId = User.FindFirstValue(ClaimTypes.NameIdentifier);
                                var cartCount = 0; var wishlistCount = 0;
                                try { cartCount = DbContext.ShoppingCartItems.Where(x => x.UserId == userId).Sum(x => (int?)x.Quantity) ?? 0; wishlistCount = DbContext.WishlistItems.Where(x => x.UserId == userId).Count(); } catch { }
                                <li class="nav-item"><a class="nav-link position-relative" asp-controller="Wishlist" asp-action="Index" title="Любими"><i class="bi bi-heart fs-5"></i>@if (wishlistCount > 0)
                                        {
                                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill badge-purple">@(wishlistCount > 9 ? "9+" : wishlistCount.ToString())</span>
                                        }</a></li>
                                <li class="nav-item"><a class="nav-link position-relative" asp-controller="Cart" asp-action="Index" title="Количка"><i class="bi bi-cart3 fs-5"></i>@if (cartCount > 0)
                                        {
                                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">@(cartCount > 9 ? "9+" : cartCount.ToString())</span>
                                        }</a></li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-person-circle fs-5 me-1"></i><span class="d-none d-md-inline">ПРОФИЛ</span></a>
                                    <ul class="dropdown-menu dropdown-menu-end shadow">
                                        <li><h6 class="dropdown-header"><i class="bi bi-person"></i> @User.Identity?.Name</h6></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item" asp-controller="Profile" asp-action="Index"><i class="bi bi-person"></i> Моят профил</a></li>
                                        <li><a class="dropdown-item" asp-controller="Orders" asp-action="MyOrders"><i class="bi bi-box-seam"></i> Моите поръчки</a></li>
                                        <li><a class="dropdown-item" asp-controller="Wishlist" asp-action="Index"><i class="bi bi-heart"></i> Любими @if (wishlistCount > 0)
                                                {
                                                    <span class="badge badge-purple ms-1">@wishlistCount</span>
                                                }</a></li>
                                        <li><a class="dropdown-item" asp-controller="Cart" asp-action="Index"><i class="bi bi-cart"></i> Количка @if (cartCount > 0)
                                                {
                                                    <span class="badge bg-danger ms-1">@cartCount</span>
                                                }</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item" asp-controller="Profile" asp-action="Edit"><i class="bi bi-pencil"></i> Редактирай профил</a></li>
                                        <li><a class="dropdown-item" asp-controller="Profile" asp-action="ChangePassword"><i class="bi bi-key"></i> Смени парола</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><form asp-area="Identity" asp-page="/Account/Logout" method="post" class="d-inline"><button type="submit" class="dropdown-item text-danger"><i class="bi bi-box-arrow-right"></i> Изход</button></form></li>
                                    </ul>
                                </li>
                            }
                            else
                            {
                                <li class="nav-item"><a class="nav-link" asp-area="Identity" asp-page="/Account/Login"><i class="bi bi-box-arrow-in-right"></i> ВХОД</a></li>
                                <li class="nav-item"><a class="nav-link" asp-area="Identity" asp-page="/Account/Register"><i class="bi bi-person-plus"></i> РЕГИСТРАЦИЯ</a></li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div class="container"><main role="main">@RenderBody()</main></div>

    <footer class="bg-dark text-white py-5 mt-auto">
        <div class="container">
            <div class="row g-4">
                <div class="col-lg-4 col-md-6">
                    <h5 class="mb-3"><i class="bi bi-shoe"></i> ShoeAholic</h5>
                    <p class="text-muted">Вашата дестинация за стилни и качествени обувки на достъпни цени.</p>
                    <div class="social-links mt-3">
                        <a href="#" class="text-white me-3" title="Facebook"><i class="bi bi-facebook fs-5"></i></a>
                        <a href="#" class="text-white me-3" title="Instagram"><i class="bi bi-instagram fs-5"></i></a>
                        <a href="#" class="text-white me-3" title="Twitter"><i class="bi bi-twitter fs-5"></i></a>
                    </div>
                </div>
                <div class="col-lg-2 col-md-6">
                    <h5 class="mb-3">Линкове</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a asp-controller="Home" asp-action="Index" class="text-decoration-none text-muted footer-link"><i class="bi bi-chevron-right"></i> Начало</a></li>
                        <li class="mb-2"><a asp-controller="Products" asp-action="Index" class="text-decoration-none text-muted footer-link"><i class="bi bi-chevron-right"></i> Продукти</a></li>
                        <li class="mb-2"><a asp-controller="About" asp-action="Index" class="text-decoration-none text-muted footer-link"><i class="bi bi-chevron-right"></i> За нас</a></li>
                        <li class="mb-2"><a asp-controller="Contact" asp-action="Index" class="text-decoration-none text-muted footer-link"><i class="bi bi-chevron-right"></i> Контакти</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-md-6">
                    <h5 class="mb-3">Категории</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a asp-controller="Products" asp-action="Index" asp-route-category="Men" class="text-decoration-none text-muted footer-link"><i class="bi bi-chevron-right"></i> Мъже</a></li>
                        <li class="mb-2"><a asp-controller="Products" asp-action="Index" asp-route-category="Women" class="text-decoration-none text-muted footer-link"><i class="bi bi-chevron-right"></i> Жени</a></li>
                    </ul>
                </div>
                <div class="col-lg-4 col-md-6">
                    <h5 class="mb-3">Контакти</h5>
                    <ul class="list-unstyled text-muted">
                        <li class="mb-2"><i class="bi bi-geo-alt text-primary"></i> гр. Велико Търново, ул. Примерна 123</li>
                        <li class="mb-2"><i class="bi bi-envelope text-primary"></i><a href="mailto: info@shoeaholic.bg" class="text-decoration-none text-muted footer-link"> info@shoeaholic.bg</a></li>
                        <li class="mb-2"><i class="bi bi-telephone text-primary"></i><a href="tel: +359881234567" class="text-decoration-none text-muted footer-link"> +359 88 123 4567</a></li>
                        <li class="mb-2"><i class="bi bi-clock text-primary"></i> Пон - Пет: 9:00 - 18:00</li>
                    </ul>
                </div>
            </div>
            <hr class="my-4 bg-secondary" />
            <div class="row">
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0"><p class="mb-0 text-muted">&copy; @DateTime.Now.Year ShoeAholic. Всички права запазени.</p></div>
                <div class="col-md-6 text-center text-md-end">
                    <a href="#" class="text-decoration-none text-muted footer-link me-3">Политика за поверителност</a>
                    <a href="#" class="text-decoration-none text-muted footer-link">Общи условия</a>
                </div>
            </div>
        </div>
    </footer>

    <style>
        footer {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            color: #fff;
        }

            footer .text-muted {
                color: #ffffff !important;
            }

            footer a.text-muted {
                color: #ffffff !important;
            }

            footer h5 {
                color: #fff;
                font-weight: 600;
                position: relative;
                padding-bottom: 10px;
            }

                footer h5::after {
                    content: '';
                    position: absolute;
                    left: 0;
                    bottom: 0;
                    width: 50px;
                    height: 2px;
                    background: #9528de;
                    color: #fff;
                }

        .footer-link {
            transition: all 0.3s ease;
        }

            .footer-link:hover {
                color: #9528de !important;
                padding-left: 5px;
            }

        .social-links a {
            transition: all 0.3s ease;
            display: inline-block;
        }

            .social-links a:hover {
                color: #9528de !important;
                transform: translateY(-3px);
            }

        .text-primary {
            color: #9528de !important;
        }

        footer hr {
            opacity: 0.2;
        }

        html, body {
            height: 100%;
        }

        body {
            display: flex;
            flex-direction: column;
        }

        footer {
            margin-top: auto;
        }
    </style>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
    <script>if (window.jQuery && jQuery.validator) { jQuery.extend(jQuery.validator.messages, { number: "Моля, въведете валидно число (напр. 129,99)." }); }</script>
</body>
</html>
